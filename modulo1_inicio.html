<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NeoStudy - Crear Cuenta / Iniciar Sesi√≥n</title>
<!-- Incluir Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- Configuraci√≥n de Supabase CORREGIDA -->
<script>
// Configuraci√≥n de Supabase
const SUPABASE_URL = 'https://kaxzmgypqchklxxyjrpw.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtheHptZ3lwcWNoa2x4eHlqcnB3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3ODc1MTgsImV4cCI6MjA4MDM2MzUxOH0.lTmPM0tJcMYFRtdhJQozllHNA3iLQTNJK-j_06XqakE';

// Variable global para Supabase
let supabaseClient = null;

// Inicializar Supabase cuando cargue la biblioteca
function initSupabase() {
    try {
        if (typeof supabase !== 'undefined') {
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            console.log("‚úÖ Supabase inicializado correctamente");
            window.supabaseClient = supabaseClient;
            return supabaseClient;
        } else {
            console.error("‚ùå Supabase no se carg√≥ correctamente");
            return null;
        }
    } catch (error) {
        console.error("‚ùå Error al inicializar Supabase:", error);
        return null;
    }
}

// Inicializar cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', function() {
    // Intentar inicializar inmediatamente
    initSupabase();
    
    // Tambi√©n verificar despu√©s de un breve retraso
    setTimeout(function() {
        if (!window.supabaseClient) {
            console.log("Reintentando inicializaci√≥n de Supabase...");
            initSupabase();
        }
    }, 1000);
});
</script>
<style>
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    overflow-x: hidden;
    background: linear-gradient(120deg, #001F3F, #003366, #00C4FF);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    padding: 20px;
  }

  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 30px;
    width: 100%;
    max-width: 450px;
    text-align: center;
    box-shadow: 0 0 30px rgba(0,0,0,0.4);
  }

  h1 { 
    color: #00C4FF; 
    font-size: 2em; 
    margin-bottom: 15px; 
  }
  
  p { 
    font-size: 1em; 
    color: #dfe9ff; 
    margin-bottom: 25px; 
  }

  select, input, button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 10px;
    border: none;
    font-size: 1em;
  }

  input { 
    background: rgba(255,255,255,0.9); 
    color: #333; 
  }
  
  input:focus { 
    outline: none; 
    box-shadow: 0 0 12px #00C4FF; 
    transform: scale(1.03); 
  }

  button {
    background: linear-gradient(90deg,#00C4FF,#007bff);
    color: white;
    cursor: pointer;
    margin-top: 10px;
    box-shadow: 0 0 15px #00C4FF;
    transition: 0.3s;
  }

  button:hover { 
    transform: scale(1.05); 
    box-shadow: 0 0 25px #00FFFF; 
  }

  .footer { 
    margin-top: 15px; 
    font-size: 0.9em; 
    color: #cbd7ff; 
  }
  
  .footer a { 
    color: #00C4FF; 
    text-decoration: none; 
    cursor: pointer;
    font-weight: bold;
  }
  
  .footer a:hover { 
    text-decoration: underline; 
  }

  .hidden { 
    display: none; 
  }
  
  /* Estilos para etiquetas de fecha */
  .date-label {
    display: block;
    text-align: left;
    margin: 10px 0 5px;
    color: #dfe9ff;
    font-size: 0.9em;
  }
  
  /* Separador */
  .separator {
    display: flex;
    align-items: center;
    text-align: center;
    margin: 20px 0;
    color: #dfe9ff;
  }
  
  .separator::before,
  .separator::after {
    content: '';
    flex: 1;
    border-bottom: 1px solid rgba(255,255,255,0.2);
  }
  
  .separator:not(:empty)::before {
    margin-right: 15px;
  }
  
  .separator:not(:empty)::after {
    margin-left: 15px;
  }
  
  /* Indicador de carga */
  .loader {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255,255,255,.3);
    border-radius: 50%;
    border-top-color: #00C4FF;
    animation: spin 1s ease-in-out infinite;
    margin-right: 10px;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Mensajes de estado */
  .status-message {
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    text-align: left;
    font-size: 0.9em;
  }
  
  .success { background: rgba(76, 175, 80, 0.2); border-left: 4px solid #4CAF50; }
  .error { background: rgba(244, 67, 54, 0.2); border-left: 4px solid #F44336; }
  .info { background: rgba(33, 150, 243, 0.2); border-left: 4px solid #2196F3; }
  
  /* Mejoras para dispositivos m√≥viles */
  @media (max-width: 480px) {
    body {
      padding: 10px;
      align-items: flex-start;
    }
    
    .container {
      padding: 20px;
      border-radius: 15px;
      margin-top: 20px;
    }
    
    h1 {
      font-size: 1.7em;
    }
    
    select, input, button {
      padding: 14px;
      font-size: 16px; /* Evita zoom autom√°tico en iOS */
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>NeoStudy üöÄ</h1>
  <p>Tu educaci√≥n digital comienza aqu√≠</p>

  <!-- Mensajes de estado din√°micos -->
  <div id="statusMessage" class="status-message hidden"></div>

  <!-- Selecci√≥n de categor√≠a -->
  <select id="categoria">
    <option value="">Selecciona tu categor√≠a</option>
    <option value="profesional">Profesional</option>
    <option value="universitario">Estudiante Universitario</option>
    <option value="secundaria">Alumno de Secundaria</option>
    <option value="general">P√∫blico en general</option>
  </select>

  <!-- Formularios din√°micos -->
  <form id="formProfesional" class="hidden">
    <input type="text" id="prof_nombre" placeholder="Nombre y Apellido" required>
    <input type="text" id="prof_profesion" placeholder="Profesi√≥n" required>
    <input type="text" id="prof_carrera" placeholder="Carrera" required>
    <label class="date-label">Fecha de nacimiento</label>
    <input type="date" id="prof_nacimiento" required>
    <input type="text" id="prof_contacto" placeholder="Tel√©fono o Correo Electr√≥nico" required>
    <input type="password" id="prof_password" placeholder="Contrase√±a (m√≠nimo 6 caracteres)" required>
    <button type="submit" id="btnSubmitProfesional">
      <span class="btn-text">Crear Cuenta</span>
    </button>
  </form>

  <form id="formUniversitario" class="hidden">
    <input type="text" id="uni_nombre" placeholder="Nombre y Apellido" required>
    <input type="text" id="uni_universidad" placeholder="Universidad" required>
    <input type="text" id="uni_carrera" placeholder="Carrera" required>
    <input type="text" id="uni_ciclo" placeholder="Ciclo/A√±o" required>
    <label class="date-label">Fecha de nacimiento</label>
    <input type="date" id="uni_nacimiento" required>
    <input type="text" id="uni_contacto" placeholder="Tel√©fono o Correo Electr√≥nico" required>
    <input type="password" id="uni_password" placeholder="Contrase√±a (m√≠nimo 6 caracteres)" required>
    <button type="submit" id="btnSubmitUniversitario">
      <span class="btn-text">Crear Cuenta</span>
    </button>
  </form>

  <form id="formSecundaria" class="hidden">
    <input type="text" id="sec_nombre" placeholder="Nombre y Apellido" required>
    <input type="text" id="sec_colegio" placeholder="Colegio" required>
    <input type="text" id="sec_grado" placeholder="Grado/Secci√≥n" required>
    <label class="date-label">Fecha de nacimiento</label>
    <input type="date" id="sec_nacimiento" required>
    <input type="text" id="sec_contacto" placeholder="Tel√©fono o Correo Electr√≥nico" required>
    <input type="password" id="sec_password" placeholder="Contrase√±a (m√≠nimo 6 caracteres)" required>
    <button type="submit" id="btnSubmitSecundaria">
      <span class="btn-text">Crear Cuenta</span>
    </button>
  </form>

  <form id="formGeneral" class="hidden">
    <input type="text" id="gen_nombre" placeholder="Nombre y Apellido" required>
    <label class="date-label">Fecha de nacimiento</label>
    <input type="date" id="gen_nacimiento" required>
    <input type="text" id="gen_contacto" placeholder="Tel√©fono o Correo Electr√≥nico" required>
    <input type="password" id="gen_password" placeholder="Contrase√±a (m√≠nimo 6 caracteres)" required>
    <button type="submit" id="btnSubmitGeneral">
      <span class="btn-text">Crear Cuenta</span>
    </button>
  </form>

  <div class="separator">O</div>
  
  <h3>Iniciar Sesi√≥n</h3>
  <input type="text" id="login_contacto" placeholder="Tel√©fono o Correo Electr√≥nico">
  <input type="password" id="login_password" placeholder="Contrase√±a">
  <button id="btnLogin">
    <span class="btn-text">Iniciar Sesi√≥n</span>
  </button>
  
  <button id="btnGoogleLogin" style="background: linear-gradient(90deg, #DB4437, #EA4335); margin-top: 15px;">
    <span class="btn-text">Iniciar con Google</span>
  </button>

  <div class="footer">
    ¬øNo tienes cuenta? <a id="btnCrearCuenta">Crea tu cuenta</a>
  </div>
</div>

<script>
// Inicializaci√≥n de variables
const categoriaSelect = document.getElementById("categoria");
const forms = {
  profesional: document.getElementById("formProfesional"),
  universitario: document.getElementById("formUniversitario"),
  secundaria: document.getElementById("formSecundaria"),
  general: document.getElementById("formGeneral")
};

// Funci√≥n para mostrar mensajes de estado
function showStatus(message, type = 'info') {
  const statusEl = document.getElementById('statusMessage');
  statusEl.textContent = message;
  statusEl.className = `status-message ${type}`;
  statusEl.classList.remove('hidden');
  
  // Auto-ocultar mensajes informativos despu√©s de 5 segundos
  if (type === 'info') {
    setTimeout(() => {
      statusEl.classList.add('hidden');
    }, 5000);
  }
}

// Funci√≥n para mostrar/ocultar loader en botones
function setButtonLoading(buttonId, isLoading) {
  const button = document.getElementById(buttonId);
  if (!button) return;
  
  const btnText = button.querySelector('.btn-text');
  if (isLoading) {
    btnText.innerHTML = `<span class="loader"></span>Procesando...`;
    button.disabled = true;
  } else {
    // Restaurar texto original seg√∫n el bot√≥n
    if (buttonId === 'btnLogin') {
      btnText.textContent = 'Iniciar Sesi√≥n';
    } else if (buttonId.includes('Submit')) {
      btnText.textContent = 'Crear Cuenta';
    } else {
      btnText.textContent = button.getAttribute('data-original-text') || 'Continuar';
    }
    button.disabled = false;
  }
}

// Verificar si ya existe sesi√≥n activa - VERSI√ìN CORREGIDA
async function checkExistingSession() {
  try {
    // Esperar a que Supabase se inicialice
    if (!window.supabaseClient) {
      await new Promise(resolve => setTimeout(resolve, 500));
      if (!window.supabaseClient) {
        console.warn("Supabase no se inicializ√≥, reintentando...");
        initSupabase();
        await new Promise(resolve => setTimeout(resolve, 300));
      }
    }
    
    if (window.supabaseClient) {
      const { data: { session } } = await window.supabaseClient.auth.getSession();
      if (session) {
        // Usuario ya tiene sesi√≥n activa, redirigir al dashboard
        console.log("‚úÖ Sesi√≥n activa encontrada, redirigiendo...");
        showStatus("Ya tienes una sesi√≥n activa. Redirigiendo...", "info");
        setTimeout(() => {
          window.location.href = "modulo2_iniciodecisi√≥n.html";
        }, 1500);
      }
    }
  } catch (error) {
    console.error("Error verificando sesi√≥n:", error);
  }
}

// Ejecutar al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
  // Verificar sesi√≥n despu√©s de un breve retraso
  setTimeout(checkExistingSession, 1000);
});

// Bot√≥n "Crear cuenta" funcional
document.getElementById("btnCrearCuenta").addEventListener("click", function() {
  categoriaSelect.scrollIntoView({ behavior: 'smooth' });
  categoriaSelect.focus();
  showStatus("Por favor selecciona tu categor√≠a para crear tu cuenta", "info");
});

// Mostrar formulario seg√∫n categor√≠a
categoriaSelect.addEventListener("change", () => {
  const value = categoriaSelect.value;
  Object.values(forms).forEach(f => f.classList.add("hidden"));
  if(value && forms[value]) {
    forms[value].classList.remove("hidden");
    // Enfocar el primer campo del formulario
    const firstInput = forms[value].querySelector('input');
    if (firstInput) {
      setTimeout(() => firstInput.focus(), 100);
    }
  }
});

// Funci√≥n para crear cuenta con Supabase - VERSI√ìN CORREGIDA
async function saveUser(form, category) {
  try {
    // Obtener el cliente Supabase
    const supabase = window.supabaseClient;
    if (!supabase) {
      showStatus("Error de conexi√≥n. Por favor recarga la p√°gina.", "error");
      return;
    }
    
    const data = { 
      categoria: category,
      user_type: category 
    };
    
    let email = "";
    let phone = "";
    let password = "";
    let fullName = "";
    let birthDate = "";
    
    // Recoger datos del formulario
    Array.from(form.elements).forEach(input => {
      if(input.type !== "submit") {
        data[input.id] = input.value;
        
        // Identificar email/tel√©fono
        if (input.id.includes("contacto")) {
          const value = input.value.trim();
          if (value.includes("@")) {
            email = value;
            data.email = email;
          } else {
            phone = value;
            data.phone = phone;
          }
        }
        
        // Identificar contrase√±a
        if (input.type === "password") {
          password = input.value;
        }
        
        // Guardar fecha de nacimiento
        if (input.id.includes("nacimiento")) {
          birthDate = input.value;
          data.fecha_nacimiento = birthDate;
        }
        
        // Guardar nombre
        if (input.id.includes("nombre")) {
          fullName = input.value.trim();
          data.nombre_completo = fullName;
        }
      }
    });
    
    // Validaciones
    if (!email && !phone) {
      showStatus("Por favor ingresa un correo electr√≥nico o tel√©fono v√°lido", "error");
      return;
    }
    
    if (!password || password.length < 6) {
      showStatus("La contrase√±a debe tener al menos 6 caracteres", "error");
      return;
    }
    
    if (!fullName || fullName.length < 3) {
      showStatus("Por favor ingresa tu nombre completo (m√≠nimo 3 caracteres)", "error");
      return;
    }
    
    // Validar fecha de nacimiento
    if (birthDate) {
      const birthDateObj = new Date(birthDate);
      const today = new Date();
      const age = today.getFullYear() - birthDateObj.getFullYear();
      
      if (age < 13) {
        showStatus("Debes tener al menos 13 a√±os para registrarte", "error");
        return;
      }
    }
    
    // Usar email o crear uno temporal con tel√©fono
    const authEmail = email || `${phone}@neostudy.app`;
    
    // Mostrar carga
    const submitBtn = form.querySelector('button[type="submit"]');
    const buttonId = submitBtn.id;
    setButtonLoading(buttonId, true);
    
    // 1. Registrar usuario en Supabase Auth
    const { data: authData, error: authError } = await supabase.auth.signUp({
      email: authEmail,
      password: password,
      options: {
        data: {
          full_name: fullName,
          user_type: category,
          phone: phone,
          categoria: category,
          fecha_nacimiento: birthDate
        },
        emailRedirectTo: window.location.origin + '/modulo2_iniciodecisi√≥n.html'
      }
    });
    
    if (authError) {
      setButtonLoading(buttonId, false);
      
      if (authError.message.includes("already registered") || authError.message.includes("User already registered")) {
        showStatus("Este correo o tel√©fono ya est√° registrado. Por favor inicia sesi√≥n.", "error");
      } else if (authError.message.includes("Invalid email")) {
        showStatus("Por favor ingresa un correo electr√≥nico v√°lido", "error");
      } else {
        showStatus("Error al crear cuenta: " + authError.message, "error");
      }
      return;
    }
    
    // 2. Guardar datos adicionales en tabla 'usuarios'
    const { error: dbError } = await supabase
      .from('usuarios')
      .insert([
        {
          id: authData.user.id,
          email: authEmail,
          phone: phone,
          nombre_completo: fullName,
          user_type: category,
          categoria: category,
          fecha_nacimiento: birthDate,
          profesion: data.prof_profesion || null,
          carrera: data.prof_carrera || data.uni_carrera || null,
          universidad: data.uni_universidad || null,
          colegio: data.sec_colegio || null,
          grado: data.sec_grado || null,
          ciclo: data.uni_ciclo || null,
          created_at: new Date()
        }
      ]);
    
    // Restaurar bot√≥n
    setButtonLoading(buttonId, false);
    
    if (dbError) {
      console.warn("Nota: Datos adicionales no guardados. Error:", dbError.message);
      // No mostramos error al usuario porque la cuenta de auth s√≠ se cre√≥
    }
    
    if (authData.user && authData.user.identities && authData.user.identities.length === 0) {
      // Usuario ya existe
      showStatus("‚úÖ Este usuario ya existe. Por favor inicia sesi√≥n.", "success");
    } else if (authData.user && !authData.user.email_confirmed_at) {
      // Email necesita confirmaci√≥n
      showStatus("‚úÖ ¬°Cuenta creada con √©xito! Por favor revisa tu correo para confirmar tu cuenta.", "success");
    } else {
      // Cuenta creada y confirmada
      showStatus("‚úÖ ¬°Cuenta creada con √©xito! Redirigiendo...", "success");
    }
    
    // Limpiar formulario
    form.reset();
    categoriaSelect.value = "";
    Object.values(forms).forEach(f => f.classList.add("hidden"));
    
    // Intentar inicio de sesi√≥n autom√°tico si ya est√° confirmado
    if (authData.session) {
      // Guardar informaci√≥n localmente
      localStorage.setItem("neoStudyUser", JSON.stringify({
        id: authData.user.id,
        email: authData.user.email,
        nombre: fullName,
        categoria: category
      }));
      
      // Redirigir despu√©s de 3 segundos
      setTimeout(() => {
        window.location.href = "modulo2_iniciodecisi√≥n.html";
      }, 3000);
    } else {
      // Si no hay sesi√≥n, ofrecer ir al login
      setTimeout(() => {
        if (confirm("¬øDeseas ir a la p√°gina de inicio de sesi√≥n?")) {
          document.getElementById("login_contacto").value = email || phone;
          document.getElementById("login_contacto").focus();
        }
      }, 2000);
    }
    
  } catch (error) {
    console.error("Error completo:", error);
    showStatus("Error al crear la cuenta. Por favor intenta nuevamente.", "error");
    
    // Restaurar bot√≥n en caso de error
    const submitBtn = form.querySelector('button[type="submit"]');
    setButtonLoading(submitBtn.id, false);
  }
}

// Asignar eventos a formularios
Object.keys(forms).forEach(cat => {
  forms[cat].addEventListener("submit", async (e) => {
    e.preventDefault();
    await saveUser(forms[cat], cat);
  });
});

// Login con Supabase - VERSI√ìN CORREGIDA
document.getElementById("btnLogin").addEventListener("click", async () => {
  try {
    const supabase = window.supabaseClient;
    if (!supabase) {
      showStatus("Error de conexi√≥n. Por favor recarga la p√°gina.", "error");
      return;
    }
    
    const emailOrPhone = document.getElementById("login_contacto").value.trim();
    const password = document.getElementById("login_password").value;
    
    if (!emailOrPhone || !password) {
      showStatus("Por favor completa todos los campos", "error");
      return;
    }
    
    // Mostrar carga
    setButtonLoading('btnLogin', true);
    
    // Determinar si es email o tel√©fono
    const loginEmail = emailOrPhone.includes("@") 
      ? emailOrPhone 
      : `${emailOrPhone}@neostudy.app`;
    
    // Iniciar sesi√≥n con Supabase
    const { data, error } = await supabase.auth.signInWithPassword({
      email: loginEmail,
      password: password
    });
    
    // Restaurar bot√≥n
    setButtonLoading('btnLogin', false);
    
    if (error) {
      if (error.message.includes("Invalid login credentials")) {
        showStatus("Credenciales incorrectas. Verifica tu email/tel√©fono y contrase√±a.", "error");
      } else if (error.message.includes("Email not confirmed")) {
        showStatus("Por favor confirma tu email antes de iniciar sesi√≥n.", "error");
      } else if (error.message.includes("User not found")) {
        showStatus("Usuario no encontrado. Por favor crea una cuenta primero.", "error");
      } else {
        showStatus("Error al iniciar sesi√≥n: " + error.message, "error");
      }
      return;
    }
    
    showStatus("‚úÖ ¬°Inicio de sesi√≥n exitoso! Redirigiendo...", "success");
    
    // Obtener datos adicionales del usuario
    const { data: userData } = await supabase
      .from('usuarios')
      .select('*')
      .eq('id', data.user.id)
      .single();
    
    // Guardar informaci√≥n localmente para uso inmediato
    localStorage.setItem("neoStudyUser", JSON.stringify({
      id: data.user.id,
      email: data.user.email,
      nombre: data.user.user_metadata?.full_name || userData?.nombre_completo || "Usuario",
      categoria: data.user.user_metadata?.categoria || userData?.categoria || "general",
      user_type: data.user.user_metadata?.user_type || userData?.user_type
    }));
    
    // Redirigir al dashboard despu√©s de 1.5 segundos
    setTimeout(() => {
      window.location.href = "modulo2_iniciodecisi√≥n.html";
    }, 1500);
    
  } catch (error) {
    console.error("Login error:", error);
    showStatus("Error al iniciar sesi√≥n. Por favor verifica tus credenciales.", "error");
    
    // Restaurar bot√≥n en caso de error
    setButtonLoading('btnLogin', false);
  }
});

// Login con Google
document.getElementById("btnGoogleLogin").addEventListener("click", async () => {
  try {
    const supabase = window.supabaseClient;
    if (!supabase) {
      showStatus("Error de conexi√≥n. Por favor recarga la p√°gina.", "error");
      return;
    }
    
    // Guardar texto original del bot√≥n
    const btn = document.getElementById('btnGoogleLogin');
    const btnText = btn.querySelector('.btn-text');
    const originalText = btnText.textContent;
    btnText.innerHTML = `<span class="loader"></span>Conectando...`;
    btn.disabled = true;
    
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: window.location.origin + '/modulo2_iniciodecesi√≥n.html',
        queryParams: {
          access_type: 'offline',
          prompt: 'consent'
        }
      }
    });
    
    // Restaurar bot√≥n
    btnText.textContent = originalText;
    btn.disabled = false;
    
    if (error) {
      showStatus("Error al iniciar con Google: " + error.message, "error");
    }
  } catch (error) {
    console.error("Google login error:", error);
    showStatus("Error al iniciar sesi√≥n con Google.", "error");
    
    // Restaurar bot√≥n
    const btn = document.getElementById('btnGoogleLogin');
    const btnText = btn.querySelector('.btn-text');
    btnText.textContent = 'Iniciar con Google';
    btn.disabled = false;
  }
});

// Validaci√≥n en tiempo real para contrase√±as
document.addEventListener('input', function(e) {
  if (e.target.type === 'password') {
    const password = e.target.value;
    if (password.length > 0 && password.length < 6) {
      e.target.style.border = '2px solid #FF6B6B';
      e.target.style.boxShadow = '0 0 5px rgba(255, 107, 107, 0.5)';
    } else if (password.length >= 6) {
      e.target.style.border = '2px solid #4CAF50';
      e.target.style.boxShadow = '0 0 5px rgba(76, 175, 80, 0.5)';
    } else {
      e.target.style.border = 'none';
      e.target.style.boxShadow = 'none';
    }
  }
});

// Validaci√≥n de email/tel√©fono en tiempo real
document.getElementById('login_contacto').addEventListener('input', function(e) {
  const value = e.target.value.trim();
  if (value.includes('@')) {
    // Es un email, validar formato b√°sico
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (emailRegex.test(value)) {
      e.target.style.border = '2px solid #4CAF50';
    } else if (value.length > 0) {
      e.target.style.border = '2px solid #FF6B6B';
    }
  } else if (value.length > 0) {
    // Es un tel√©fono, validar que tenga al menos 8 d√≠gitos
    const digits = value.replace(/\D/g, '').length;
    if (digits >= 8) {
      e.target.style.border = '2px solid #4CAF50';
    } else {
      e.target.style.border = '2px solid #FF6B6B';
    }
  } else {
    e.target.style.border = 'none';
  }
});

// Funci√≥n para formatear fecha
function formatearFecha(fechaISO) {
  if (!fechaISO) return "";
  const fecha = new Date(fechaISO);
  const opciones = { day: 'numeric', month: 'long', year: 'numeric' };
  return fecha.toLocaleDateString('es-ES', opciones);
}

// Permitir login con Enter en los campos
document.getElementById('login_password').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    document.getElementById('btnLogin').click();
  }
});

// Permitir crear cuenta con Enter en los formularios
Object.values(forms).forEach(form => {
  form.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && e.target.type !== 'submit') {
      e.preventDefault();
      const submitBtn = form.querySelector('button[type="submit"]');
      if (submitBtn) submitBtn.click();
    }
  });
});
</script>
</body>
</html>
